function [Y,Xf,Af] = NN(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 28-Jun-2021 20:27:38.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx7 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx3 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [10619;10140;9878;10055;9574;10241;10095];
x1_step1.gain = [0.0285714285714286;0.0392156862745098;0.0210526315789474;0.00909090909090909;0.001953125;0.0465116279069767;0.0181818181818182];
x1_step1.ymin = -1;

% Layer 1
b1 = [-1.3688510204779200663;-2.1381022283102897319;2.2875878352279257477;-2.8627647641994844463;-1.1454102267378192259;4.155653507838806604;-0.026590749570646814853;-4.7368747348497279859;-1.7627354865598818812;-10.10616399048580405;-0.63494592113710468517;-5.671188786253671843;-1.2066874700748704274;-0.34283551269419848539;-0.7590141475256779735;3.0520042975631032078;-0.20313541133468929201;0.57228193664080440062;-0.21230836145677245419;-2.2610927861307388298;-0.46026372870879422861;0.11342097709810092243;-1.769343180820810657;-4.250122826108848173;-0.40996154992443878395;-0.52421968705646670994;-0.58344273771371202297;-0.45075615496313803376;2.739782397705207817;-2.8371822884243189655;0.011169378844381344998;-0.0037864188508277014239;2.5820758629024131992;0.8743852956084663397;-1.8763877943449156493;1.9024712017311029566;2.0066089903400050609;1.6524897702759382412;2.4277564480702378269;-2.0569641252628669825;-4.1784522904209628891;-3.5413370072326486593;2.2184869214621119049;3.654407341731084724;-2.0898642585623559143;-4.8074632816214126763;-3.207749011677666573;1.6199293442586273351;6.0266690414038590617;1.9698273823309302433;-4.2796971082884924797;3.6175720941186293445;3.6130904950392825903;-4.9073931602440428179;-1.5727939822189909158;-1.5331853945488300717;10.59381630888109882;-1.1684256771636238881;4.2550816552347319188;-3.81463144121247133];
IW1_1 = [-0.065142565435030039267 -0.44699926907975195967 -0.1296914520095794332 1.1539839960973621302 -1.5859562724113427379 -1.8168484334545764725 -0.85566608196032067912;0.21646940066088782295 -1.7358082464027682068 2.3633623072615597138 0.60916444530242841449 0.80993162091886772291 2.3053012480510686188 1.8350476544190328365;-1.5340253758477511159 0.78162412993752061752 -1.1691474020001761946 -1.7514558310983823208 0.65276523058642776931 0.48428678941333558328 -1.035410146667692155;1.7038614402952105831 0.011625125406081852214 -0.95573936627105837704 -1.347240097412014892 -1.3239519509006532072 -2.8963579178128062708 2.5533563751251748819;-1.075134694912122546 -0.6796931817893654415 2.8654490276826440898 1.3156809052023081819 4.003915739825528064 0.67130980694157316169 0.1694024165397243209;1.2974075084769325361 1.2609958489858970054 0.50684500565282442075 -1.7322527700123466765 1.6154255144899223318 -0.16818905913614540237 -2.6981131207023367757;0.75414390305864531516 1.0654863210299221343 -2.9039519045466697378 -0.87743897081763100321 -0.60352755347777387041 -0.89415732001050096667 1.0182271700386897884;-0.21710044966994876403 1.4311327277127900981 -0.56214254822683551449 -0.29392976079997634731 -1.8839034159161409665 2.2460479093100134129 2.3648212408110991234;-0.46071628979202744469 -0.24248613906059832135 -0.23322590197951728608 0.6271751025871533658 -1.1146305581826501108 0.12103349627900715502 -0.54397929075790785181;6.3116251746719784776 -6.0398636979206496989 0.74542733631204172173 -4.0737077379118620257 2.2478872974223382819 -4.3136447199518519469 2.9353497734235016736;-3.0727867201059670954 6.0609536956574618927 -3.100527837950764809 1.6078859800300202565 0.70012991961213733028 -0.4417797934838439966 -0.53425085128068483531;2.9795093992157806184 1.4517886396011157046 0.15193915836707333478 2.5091375270158264854 2.8781251808933605574 -3.0303402556757479402 4.8319657563042621717;-2.7976720012310192232 3.8177630555839274784 -0.15117238262062376863 0.48028534226470692703 1.5353388108058820816 2.6096049695670848756 -3.5950083606109304313;-0.39799049078340270613 2.0691069704053832723 -2.2130590439140207515 -0.10322321793276037494 -0.83614291392867634567 -0.67917645938816284534 -0.36268689477509874486;-2.3936323543894362231 4.3603192109633477358 -1.8395708154302683468 1.0432792170793054876 2.7871973053487857364 1.2427646049117677673 -1.8921584692659825233;-1.8545452011547705062 1.9288559038844232951 -2.712033578537043077 -2.1626965358207552725 3.2044468964723633597 -2.3810066395100561998 -1.0185770251658026186;0.92535057197738435075 -2.1562341297773697235 2.1090566941931414569 -0.49153113186607338969 -0.026013674679596785616 0.20216641088451969832 0.57567542338312505112;-1.2625401457197633626 -2.0553465084513784511 5.2685806708947282573 1.4114143328208730299 1.486006784062421815 7.7086464036144128897 -5.9041718637490765431;0.3880472020983171122 0.30075508132731237909 -1.9395090190658670348 4.2369267165722419577 0.7853723124409182077 -3.3021479665463910891 0.41470912635272516589;0.35860617985048875989 5.7333854417642236001 -1.1911565734448119613 -2.5544182885565831498 1.6813132819981175814 -0.2479351446498689604 -3.3832776783026430323;0.46922937838472850158 -0.15112574177793233754 1.5249770171969008192 0.51984072720606488982 -1.3796255849740302057 -0.12175096705413464282 -1.1792288310578211696;-0.38792831346125833392 0.8355039516823764556 -1.2071678203615843206 -0.95271633880512673898 1.1838993656888945338 -0.67516102233123653775 -0.0028707201338811815308;0.86326794042224730408 0.63141986134111338647 1.2005278329985427099 1.0047070807414260063 2.4048713274141864105 2.683135802327822006 3.7101771187789545081;4.8624532756800871169 1.0260241545538706376 0.017136052057436394758 1.3637141818105809055 1.9057267180967827347 -1.2414776522459054497 -3.7809655608838692586;-0.16326573517405479352 2.4027656864528625924 -2.9578658019555970071 -0.1411986966447582037 -0.27715143495872407442 -1.2879764015288681644 2.1492988912870272245;-0.21025537414899386768 -0.74194653900749696351 -1.0210547511730796444 -0.083474988436176428275 0.22463680657091439352 -0.50171966499879916412 2.6600403162485024566;-3.2819577764580523116 6.2515180797178127037 -3.389976919229499952 2.0157305379890466668 0.98706005712651379014 -0.45889529859529826217 -0.4559415946464135394;-1.3873387854615999437 3.4612168557750804254 -4.3627469701966967719 -0.94246768090921428929 1.4896452871523855332 -1.2371444964855065063 -0.17437149848354377424;0.99069626581697489698 -7.9082100820090186488 1.6806789452075139302 2.8588206279902128593 -2.748101322418552428 -0.1805738741964049987 3.3576437317996172816;-7.3229462236610434189 1.7350143631468508687 0.53893298892539098777 2.2223022694253140585 -0.1245939126295318583 -1.8060235295842494985 -5.833572177478220766;0.64947177635751618396 -6.0343770218202799072 0.33189154342550430954 -1.3157848075432729829 -2.4784602639185342454 1.3701640139430522058 4.7799296096559586999;-1.6110890185153377008 -3.8209873178678348538 2.4543222976368692656 -6.7065706258339181645 -1.4497798007769677753 1.8404545039399167194 0.15958937023145433609;0.029607815424200323307 -5.3606607037153288786 3.1679812840581802469 3.5091604727108354211 2.121840174015624747 -3.2744792826734876456 1.577412354878096501;-0.021781908747897246736 1.0830042960791625983 -0.36301635386631020408 -0.29386573673828320086 2.2246049877589433308 1.6998533957622063983 1.1587861348970243114;-0.1386571597237337139 -2.1968531655753826826 1.5932171354962765264 -0.026663712117497521265 -5.0335003633867572148 -5.1627160883773077771 -4.6758085099104187421;-0.11454621456480088004 0.66528816875372820405 -1.092961894748668783 -0.59595459623215163436 2.5707372661290373017 -0.44997854385826202561 -1.1070567483774120809;-0.11211464938934311009 1.0723735619128806906 -1.2477588973691742247 -1.3709775337648697491 2.8908582644719014176 -1.0089188940344411272 -0.12820724664830399075;0.1984564333716058171 -5.1893229587539577707 3.0328556316435650864 3.2423356732834851535 1.11277673931208132 -3.3741349560852080813 1.3844113493745882071;-0.36974811989790695721 -2.9816745859442281841 1.5432324861453556863 1.2922840971120206355 -0.55646969064245599412 -2.4494042685297410245 -3.7597269462686702113;-0.39342537061302551571 -3.6243272716032692848 2.2768645535640938959 -7.8490727631494632277 -3.8799800601613267936 1.543228203035676982 -0.38794509185427700215;-0.69949497344956301781 -0.35286470506093747801 1.6924313690066390414 -2.5984680547045524435 -4.9694878940724782623 2.996417859557694463 -0.40780132725727713527;-3.0025336540058567003 5.2591278588175560671 -2.4665555907269807179 1.3600884277630598262 0.82697394418365699487 0.90927300090120566356 -1.1561363856731263766;0.1595875707402221455 -1.1565539740612691411 0.43479165416914777875 0.21157704815201219817 0.48626262155967114875 -1.8389745699980775129 -1.5060761638307722521;1.4159163624673627435 -1.1318650165275998543 0.21110069548294393971 -4.2225983119957088974 2.6896174604341918091 3.0873529589750727808 2.3774652121636150603;-0.98572716531282866814 0.72262800417311756629 -1.489053040410827311 -0.98378632478572780595 -0.50327018835548320563 -0.58192522962987891511 0.11629939014416988685;-1.7066836360710770926 3.6463583822890743846 -6.2254745671331903623 3.3564045804958815289 2.0549474452176998973 -1.129234541634571265 4.7278132846510612097;0.71303279770324712317 -1.5564988388924907436 2.6032474088320967098 0.68068288908387675207 2.7115024701486736269 0.70517950971260812132 0.063222194473683990257;-2.0678454724497239425 9.0681776831154419227 1.3425156752638645052 1.7268618790026235565 4.1478211999485283812 -1.4419502599905724693 -8.8334407732313096062;0.49394456369937406182 -0.63156507177360254879 0.031870962520292735187 0.53379465111289392532 4.3120051867899515941 -1.8902238316784243377 -3.0606321286234030588;0.70195069578760593831 1.4439512794013054098 -2.157753852942830175 -0.65323752242265753498 -3.9430522649448183081 -0.4721462911258115791 -0.50620382008237518878;-1.1778155047363210173 1.6923596358763572933 -5.6545216932989239567 1.3215937435113187526 -3.1542773596842059725 -0.93527745931699757254 -5.3126021026165455297;-2.015505426382484977 -5.3520407783399210899 3.3997355536958582256 -1.9545064052170255664 -1.8337325936604176313 2.3879045549937871762 -0.25623793454437004957;1.7714267270907264606 -3.7110727131679177582 4.5111905461642267667 1.0068413359987964384 1.7396729792335332565 1.3242223771869106042 0.26765936205336182674;-0.68494970261237742015 1.1216571153942969108 -0.62848164905930081758 0.096126040538212956243 -4.0829887996282083762 2.8197586417691682392 1.3878461823649519413;-4.9059671760093594983 -4.4302286629788287797 1.0478253206683461052 -4.0319231202130234593 -0.60237764205366717274 3.1029911697809500204 2.3416662525601923406;0.014448400195907477872 0.91974742002883025371 -0.050904302148119084936 -1.1353197145504307919 0.017045433186268891396 2.8090917399362580475 2.9592273415632837086;1.4985075134129415275 2.2653729542891181126 -0.50271049299509740216 -3.6468008427396045867 12.573470241502072042 1.7756376471634767178 3.2100892546237362879;0.69006685314137772291 0.85001523946940127363 -1.0882505366364563226 0.93058023950571089333 1.1611162507710068859 -0.85733249786794096803 0.40866061687416471715;1.4736313929364168729 -3.3096015798765079374 5.6198767853707396469 -2.9758158314483873497 -1.793435097626018937 1.0370466155146280673 -4.0279970638465334432;-1.0855043477412709141 0.85054056231948071964 -2.4787474291992288578 -1.4248060191707883071 1.6352776069108050372 0.2434079283029303431 1.2117870860222326179];

% Layer 2
b2 = [1.0478555307232872984;0.16118261829776536764;-2.0560041586748218911];
LW2_1 = [0.70511556116825369056 -0.37736009575602297295 -0.030012172679431525085 0.12517884922178118545 2.6718014803809349011 0.049470150865391950001 0.51009610410165207028 -1.1149567511742168868 -2.3886226235673579943 -0.37745892380574475045 0.63216580360435292718 0.049027472364420392192 0.26294047217461874455 -2.2817517195066838731 -1.0340152468870431601 0.12331951266115398491 -1.7873792937912360568 0.050080380304857875784 -0.013798531294367899144 1.0371973611092506484 -0.41147059561463089628 2.7329386828226365225 -0.027135497897804779915 -0.27302515468553251177 0.19494279806019601531 -0.18804846477015807471 -0.66815327421198777991 0.91229788735278816159 0.87915915147457635026 -0.052224204681507957471 -0.08527204454541141565 0.001566473911930264893 -0.49700245170768725389 -2.3788670920936239028 -0.18532785807670279499 1.2300948396579771682 -3.0939960869430760404 0.51656315079707337823 1.0964519745787084659 -0.0017450673501145277499 -0.0020108813470293765424 0.6724953293777315988 -3.8161976326274738014 -0.07144215106402347637 0.083383355963004723854 -0.056883925491434735033 2.7603345914930947913 -0.011278070332085369035 0.078008343028920623663 4.7273717871780078781 -0.045172306178198520787 0.19318825735463557303 0.77362475481443704339 0.61678387400213130487 -2.404480015568010603e-05 -0.46449461941698233503 1.170448274034620928 0.27195473251230051215 0.1492829369086758895 1.5116727671557259605;1.8538785485277791132 -0.27653769431335123441 -0.065372514536641904148 0.082446967185365968578 0.52691032684762761917 0.0098050346649178991842 0.34082670443809359728 0.69383011359254231909 -1.5687827876584332643 -0.17731810536401274025 -0.79800376629078717539 0.038950298465435094497 0.28906296957898941491 -1.1553432440542490411 -0.20322299779408053988 0.13825644645780296726 -0.53862778265860422611 0.058728345045332794316 0.3596519429788953004 1.0574564878053815953 0.041476384998581909691 -2.0011499921517197365 -0.14290586221352516438 0.15976728894646011203 0.35377509470678858428 -0.45872819237359951927 0.81627226446770595469 0.26543161958132399647 0.89532022271251832102 -0.10343602760389770945 0.21700337262155419693 0.21184902411611142292 0.097683403813272617899 2.5606969627054554373 0.49541062624242326873 1.2800529543979597413 0.09564691734856359262 -0.10431801595740480826 -0.32355726542932505829 -0.15603553558931002043 0.65087378414964291995 -0.031560169773933437198 2.6254862272939627488 0.10531158533362039442 0.54657625068145598846 -1.2870603960028315083 0.85695568560348589493 0.15908328919919054179 0.25641127754612363931 0.32255478071535786944 -0.027211028050600716277 -0.045882581484696774443 0.31731604180808370419 0.77383614391690869194 -0.06396637462275212016 1.2684884496119206432 -0.83142361748454940429 -0.57794614280575495879 -1.6392582989020143547 0.10020305731843601182;1.1956689726308615818 -0.44248526853886893662 -0.23528268168454988252 0.20457393413707036789 1.0444838810092715864 0.47676834759825753585 0.72363208035781367844 2.6710553561635927977 -0.90700257291466734877 -0.31037434491173349072 -0.92917222511891972569 0.21094445363632538526 0.25333926367477455077 -2.4382268013486885216 -0.84512602977987749675 0.21514011049350073579 -1.8621203296932893334 0.039064107793548338843 0.52249969298194898215 2.137526608388957694 -0.45275328095845740473 -3.8350226618198139938 -0.18081368543715287123 0.12371589953075082247 0.37548564681244966934 -0.66693970547641623359 0.83927941395806260338 0.58472484211885866756 1.5331991061093865891 -0.10248255887431920175 0.25672423699974322719 0.2557216291648446993 -0.2430561054382513464 3.8869577915281801062 0.40880132571512467488 0.89251902460838816733 0.84084287535621893284 0.20125489416150357802 -0.57938601157150748655 -0.18757145816355938472 0.79907152194326547257 0.58989230937022874013 6.6370716177240458578 -0.063082174520154382646 1.5021345098656133654 -1.6957885788518813897 1.6182944416796982701 0.15340005541115403487 0.97340421755102413126 2.3877193724307965716 -0.037851928928947835284 -0.033598387476078114822 0.59173377213267130958 0.34490427257100142455 -0.06734966952597061518 1.9416628502467612183 -0.56585798872942760784 -1.8431495508965265451 -1.9640641140165051581 0.076048486709446277976];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [0.0185185185185185;0.0740740740740741;0.019047619047619];
y1_step1.xoffset = [-45;-387;-48];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
x = bsxfun(@minus,y,settings.ymin);
x = bsxfun(@rdivide,x,settings.gain);
x = bsxfun(@plus,x,settings.xoffset);
end
